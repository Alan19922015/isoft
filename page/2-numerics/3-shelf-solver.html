<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
   <meta name="description" content="Ice Shelf/Ocean Fluid- and Thermodynamics: a suite of tools and programs to use for simulating the evolution of ice shelves interacting with the ocean.">
    
    <meta name="author" content="Chris MacMackin" >
    <link rel="icon" href="../../favicon.png">

    <title>Shelf Solver &ndash; ISOFT</title>

    <link href="../../css/bootstrap.min.css" rel="stylesheet">
    <link href="../../css/pygments.css" rel="stylesheet">
    <link href="../../css/font-awesome.min.css" rel="stylesheet">
    <link href="../../css/local.css" rel="stylesheet">
    
    <link  href="../../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../../js/jquery-2.1.3.min.js"></script>
    <script src="../../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../../index.html">ISOFT </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li><a href='../../page/index.html'>Documentation</a></li>
      
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../../lists/procedures.html">Procedures</a></li>
        
        
            <li><a href="../../lists/absint.html">Abstract Interfaces</a></li>
               
            <li><a href="../../lists/types.html">Derived Types</a></li>
        
        
            </ul>
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../../lists/procedures.html">Procedures</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../../lists/absint.html">Abstract Interfaces</a></li>
                             
<li class="visible-xs hidden-sm visible-lg"><a href="../../lists/types.html">Derived Types</a></li>


          </ul>
        
        <form action="../../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  <div class="row">
    <h1>Shelf Solver</h1>
    <div class="row">
    <div class="col-lg-12">
    <div class="well well-sm" style="min-height: 40px;">
      <ul class="list-inline" style="margin-bottom:0px; display:inline">
         
        <li><i class="fa fa-pencil"></i> Chris MacMackin</li>
         
         
        <li><i class="fa fa-calendar-o"></i> December 2018</li>
         
<!--
        
-->
      </ul>
        <ol class="breadcrumb in-well">
      
         <li><a href='../../page/index.html'>Documentation</a></li>
      
         <li><a href='../../page/2-numerics/index.html'>Numerical Methods</a></li>
      
         <li class="active">Shelf Solver</li>
      </ol>
    </div>
    </div>
    </div>
  </div>
  
  <div class="row">
    <div class="col-md-9 col-md-push-3" id='text'>
      <p>Simulating the evolution the ice shelf mass balance using
<a href="./1-equations.html#mjx-eqn-eqice-height-nd">equation 1</a> requires a time-stepping scheme. In
order to allow numerical stability with large time steps, a
semi-implicit method is used. This works by defining the residual
operator <script type="math/tex">
\def\bm#1{{\boldsymbol{#1}}}
\newcommand{\dx}{\mathcal{D}_x}
\setcounter{21}
</script>
<script type="math/tex; mode=display">\begin{equation}
  \label{eq:shelf-resid}
  \bm{f}(h_n) =
  \frac{h_n - h_{n-1}}{\Delta t} +
  \frac{\partial}{\partial x}(h_{n}u_n(h_n)) + \lambda m_{n-1}
\end{equation}</script>
where the subscript <script type="math/tex">n</script> indicates the value at the time step being
solved for, while subscript <script type="math/tex">n - 1</script> indicates the value at the
previous time step. This is a semi-implicit scheme (rather than fully
implicit) because melt rate <script type="math/tex">m_{n-1}</script> is used from the previous time
step, rather using <script type="math/tex">m_n</script> from the current time step. In this equation,
<script type="math/tex">h_n</script> and <script type="math/tex">u_n</script> represent vectors of thickness and velocity values at
each grid point at time step <script type="math/tex">n</script>, while <script type="math/tex">h_{n-1}</script> is a vector of
thickness values at the previous time step and <script type="math/tex">\partial/\partial x</script>
is evaluated using the <a href="./2-spatial.html">Chebyshev differentiation procedure</a>
previously described. This is a nonlinear system
and can be solved using Newton's method, where the root is determined
iteratively by solving the linear equation
<script type="math/tex; mode=display">\begin{equation}
  \label{eq:newton}
  \bm{J}\delta\bm{s}^k_n = -\bm{f}(\bm{s}^k_n).
\end{equation}</script>
Here, <script type="math/tex">\bm{s}_n = h_n</script> is the current value of the ice thickness, <script type="math/tex">\bm{J}</script> is the Jacobian of <script type="math/tex">f</script>,
and the new iterate <script type="math/tex">\bm{s}^{k+1}_n = \bm{s}^{k}_n + \delta\bm{s}^k_n</script>.</p>
<p>In order to avoid having to evaluate the Jacobian of this system, a
Jacobian-free Newton-Krylov method
<a href="../bibliog.html#Knoll2004">(Knoll and Keyes, 2004)</a> is used. This
solves the linear <a href="#mjx-eqn-eqnewton">equation 23</a> iteratively via a Krylov
method which only requires the product of the Jacobian with the
iterate, and not the actual Jacobian itself. This product is
approximated as a finite difference:
<script type="math/tex; mode=display">\begin{equation}
  \label{eq:jac-fin-diff}
  \bm{J}\bm{v} \approx \frac{\bm{f}(\bm{s} + \epsilon\bm{v}) -
    \bm{f}(\bm{s})}{\epsilon}.
\end{equation}</script>
The NITSOL implementation
<a href="../6-bibliog.html#Pernice1998">(Pernice and Walker, 1998)</a> of a Newton-Krylov
solver was chosen, as it is very flexible and written in Fortran,
which was the language other portions of the code were to be
implemented with.</p>
<p>The spectral discretisation used here corresponds to dense matrices,
making <a href="#mjx-eqn-eqnewton">equation 23</a> very poorly conditioned. As a
result, the Krylov solvers in NITSOL were unable to converge on a
solution without a preconditioner. Even with relatively-sparse
matrices, preconditioners are often needed for iterative methods
(e.g.: <a href="../6-bibliog.html#Pernice1998">Pernice and Walker, 1998</a>;
<a href="../6-bibliog.html#Knoll2004">Knoll and Keyes, 2004</a>). A right preconditioner,
<script type="math/tex">\bm{P}^{-1}</script>, is chosen so that the modified problem
<script type="math/tex">(\bm{J}\bm{P}^{-1})\bm{q} = -\bm{f}(\bm{s})</script> is well-conditioned and
can be solved for <script type="math/tex">\bm{q}</script>. It is then easy to find <script type="math/tex">\bm{s}</script> using
<script type="math/tex">\bm{P}\delta\bm{s} = \bm{q} \Rightarrow \delta\bm{s} =
\bm{P}^{-1}\bm{q}</script>. A good preconditioner will have
<script type="math/tex">\bm{P}^{-1} \approx \bm{J}^{-1}</script>, so that
<script type="math/tex">\bm{J}\bm{P}^{-1} \approx \bm{I}</script> to a decent approximation. A
tradeoff must be made between a preconditioner which is a sufficiently
good approximation of <script type="math/tex">\bm{J}^{-1}</script> to be useful and one which is not
too expensive or unstable to apply (e.g. <script type="math/tex">P^{-1} = J^{-1}</script> would be a
perfect preconditioner but constructing it is of equal difficulty to
solving the original, unpreconditioned problem).</p>
<p>The Jacobian of <a href="#mjx-eqn-eqshelf-resid">equation 1</a> can be expressed as
<script type="math/tex; mode=display">\begin{equation}
  \label{eq:shelf-jacob}
  \bm{J} = \frac{1}{\Delta t} + \dx u,
\end{equation}</script>
where we define <script type="math/tex">\dx A \equiv \partial A/\partial x + A\Delta_x</script>, and
<script type="math/tex">\Delta_x</script> is the differential operator in the <script type="math/tex">x</script>-direction. Although
<script type="math/tex">\Delta_x</script> will be a dense matrix when using a spectral method, it can
be approximated as a sparse finite difference operator, as proposed
by <a href="../6-bibliog.html#Orszag1980">Orszag (1980)</a>. In this case
<script type="math/tex">\Delta_x</script>, and thus also <script type="math/tex">\dx</script>,
are tridiagonal matrices. This means that the finite difference form
of the Jacobian can be "inverted" simply by solving the tridiagonal
system, which can be done efficiently using a routine in LAPACK
<a href="../6-bibliog.html#Anderson1999">(Anderson et al., 1999)</a>.
This proved effective at preconditioning the
Krylov solver in NITSOL, whilst maintaining the accuracy of the
underlying pseudospectral method.</p>
<p>The <script type="math/tex">u_n(h_n)</script> term in <a href="#mjx-eqn-eqshelf-resid">equation 1</a> can itself be
found by solving a nonlinear system, this time with the form
<script type="math/tex; mode=display">\begin{equation}
  \label{eq:u-resid}
  \bm{f}(u_n) =
  \frac{\partial}{\partial x}\left(4\eta_{n}h_{n}\frac{\partial
      u_n}{\partial x}\right) - \chi \frac{\partial h_n^2}{\partial x}.
\end{equation}</script>
This has a Jacobian <script type="math/tex; mode=display">\begin{equation}
  \label{eq:u-jacob}
  \bm{J} = \dx(4\eta h)\Delta_x.
\end{equation}</script>
Every time a new residual is calculated using
<a href="#mjx-eqn-eqshelf-resid">equation 22</a>,
<a href="#mjx-eqn-equ-resid">equation 26</a> is solved iteratively using NITSOL.</p>
<p>It is also possible to construct a nonlinear system which takes both
<script type="math/tex">h_n</script> and <script type="math/tex">u_n</script> as arguments and solve for both simultaneously. While
this avoids the need to repeatedly solve for <script type="math/tex">u_n</script>, it proved to be much
less stable and tended to require smaller time-steps in order to
prevent failure. As such, the approach outlined above proved to be
computationally cheaper overall.</p>
<p>Of the three linear solvers provided with NITSOL, only GMRES proved
reliable, with the BiCGSTAB and TFQMR solvers typically
failing. Consult <a href="../6-bibliog.html#Pernice1998">Pernice and Walker (1998)</a> for more details on these
routines. It was also found that the "backtracking" globalisation
used in NITSOL, which is meant to prevent the solution from starting
to diverge, had a tendency to make the solver get trapped in local
minima for this problem. As such, it was turned off and this was found
to greatly improve the robustness of the nonlinear solver.</p>
    </div>
    
    <div class="col-md-3 col-md-pull-9">
      <hr class="visible-xs visible-sm">
        <div class="well toc">
          <ul class="nav nav-stacked nav-pills">
            <li role="presentation" class="title"><a href='../../page/index.html'>Documentation</a></li>
          </ul>
          <hr>
          <ul class="nav nav-stacked nav-pills">
            
            <li role="presentation">
            <a href='../../page/1-running/index.html'>Using ISOFT</a>
            
            <ul class="nav nav-stacked nav-pills">
              
            <li role="presentation">
            <a href='../../page/1-running/1-build.html'>Compiling the Code</a>
            
            </li>
            
            <li role="presentation">
            <a href='../../page/1-running/2-writing.html'>Writing Software Using the ISOFT Framework</a>
            
            </li>
            
            <li role="presentation">
            <a href='../../page/1-running/3-compile.html'>Linking to the Library</a>
            
            </li>
            
            </ul>
            
            </li>
            
            <li role="presentation">
            <a href='../../page/2-numerics/index.html'>Numerical Methods</a>
            
            <ul class="nav nav-stacked nav-pills">
              
            <li role="presentation">
            <a href='../../page/2-numerics/1-equations.html'>Shelf/Plume Equations</a>
            
            </li>
            
            <li role="presentation">
            <a href='../../page/2-numerics/2-spatial.html'>Spatial Discretisation</a>
            
            </li>
            
            <li role="presentation" class="disabled">
            <a href='../../page/2-numerics/3-shelf-solver.html'>Shelf Solver</a>
            
            </li>
            
            <li role="presentation">
            <a href='../../page/2-numerics/4-plume-solver.html'>Plume Solver</a>
            
            </li>
            
            <li role="presentation">
            <a href='../../page/2-numerics/5-benchmarking.html'>Testing and Benchmarking</a>
            
            </li>
            
            <li role="presentation">
            <a href='../../page/2-numerics/6-horzint.html'>Horizontally-Integrated Plume Equations</a>
            
            </li>
            
            </ul>
            
            </li>
            
            <li role="presentation">
            <a href='../../page/3-codeDesign/index.html'>Code Design</a>
            
            <ul class="nav nav-stacked nav-pills">
              
            <li role="presentation">
            <a href='../../page/3-codeDesign/1-representing.html'>Representing the Coupled Ice Shelf/Plume</a>
            
            </li>
            
            <li role="presentation">
            <a href='../../page/3-codeDesign/2-discretisation.html'>Discretisation</a>
            
            </li>
            
            <li role="presentation">
            <a href='../../page/3-codeDesign/3-solvers.html'>Nonlinear Solvers</a>
            
            </li>
            
            <li role="presentation">
            <a href='../../page/3-codeDesign/4-parameterisations.html'>Parameterisations and Boundary Conditions</a>
            
            </li>
            
            </ul>
            
            </li>
            
            <li role="presentation">
            <a href='../../page/4-plotting/index.html'>Plotting ISOFT Output</a>
            
            <ul class="nav nav-stacked nav-pills">
              
            <li role="presentation">
            <a href='../../page/4-plotting/1-readers.html'>Reader Objects</a>
            
            </li>
            
            <li role="presentation">
            <a href='../../page/4-plotting/3-tools.html'>General Plotting Tools</a>
            
            </li>
            
            <li role="presentation">
            <a href='../../page/4-plotting/5-layers.html'>Plotting Internal Layers</a>
            
            </li>
            
            <li role="presentation">
            <a href='../../page/4-plotting/6-scripts.html'>Provided Plotting Scripts</a>
            
            </li>
            
            </ul>
            
            </li>
            
            <li role="presentation">
            <a href='../../page/./6-bibliog.html'>Bibliography</a>
            
            </li>
            
          </ul>
        </div>
    </div>
    
  </div>

    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2018 
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
            
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> ISOFT was developed by Chris MacMackin</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="../../js/MathJax-config/mj-config.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../../tipuesearch/tipuesearch_content.js"></script>
    <script src="../../tipuesearch/tipuesearch_set.js"></script>
    <script src="../../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>